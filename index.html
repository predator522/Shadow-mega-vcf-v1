<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Owner Dashboard - Shadow VCF</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap');

body {
  font-family: 'Orbitron', sans-serif;
  margin:0; padding:20px; background:#0a0a0a; color:#e2e2e2; text-align:center;
}

h1 { text-shadow:0 0 10px #bc13fe; font-size:2.2em; }
.container { max-width:450px; margin:auto; background: rgba(20,0,40,0.8); padding:30px; border-radius:30px; border:2px solid #bc13fe; box-shadow:0 0 25px #bc13fe; }

input, select, button {
  width:100%; padding:12px 15px; margin:10px 0; border-radius:25px; font-family:'Orbitron'; font-size:1em;
  border:1px solid #00ffff; background:#111111; color:#e2e2e2;
}

button {
  background: linear-gradient(to right, #bc13fe,#00ffff); color:#fff; font-weight:bold; cursor:pointer;
  border:none; text-shadow:0 0 5px rgba(0,0,0,0.5); box-shadow:0 0 15px #bc13fe;
}

button:hover { transform:translateY(-2px); box-shadow:0 0 25px #00ffff; }

#sessionInfo, #shareSection { margin-top:20px; }
.share-link { cursor:pointer; padding:10px; border:1px solid #bc13fe; border-radius:15px; background: rgba(25,0,45,0.5); word-break:break-all; }
</style>
</head>
<body>

<h1>Owner Dashboard</h1>

<div class="container">
  <input type="text" id="ownerName" placeholder="Your Name">
  <input type="number" id="maxParticipants" placeholder="Max Participants">
  <input type="number" id="duration" placeholder="Duration">
  <select id="durationUnit">
    <option value="minutes">Minutes</option>
    <option value="hours">Hours</option>
    <option value="days">Days</option>
  </select>
  <input type="text" id="groupLink" placeholder="Join the VCF group (URL)">
  <button id="createSessionBtn" type="button">Create Session</button>
</div>

<div id="sessionInfo"></div>
<div id="shareSection" style="display:none;">
  <p>Share this link with participants:</p>
  <div class="share-link" id="shareLink">Click to copy</div>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/11.24.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.24.0/firebase-firestore.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBnbWvBJ_KtXl_1KpPGCmr-os4gKIP_uhM",
    authDomain: "shadow-vcf.firebaseapp.com",
    projectId: "shadow-vcf",
    storageBucket: "shadow-vcf.firebasestorage.app",
    messagingSenderId: "575022348228",
    appId: "1:575022348228:web:447dde12e94ac740079691",
    measurementId: "G-7SXSRVXHMT"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const btn = document.getElementById('createSessionBtn');
  const sessionInfo = document.getElementById('sessionInfo');
  const shareSection = document.getElementById('shareSection');
  const shareLink = document.getElementById('shareLink');

  btn.addEventListener('click', async () => {
    const owner = document.getElementById('ownerName').value.trim();
    const maxP = parseInt(document.getElementById('maxParticipants').value);
    const duration = parseInt(document.getElementById('duration').value);
    const unit = document.getElementById('durationUnit').value;
    const groupLink = document.getElementById('groupLink').value.trim();

    if(!owner||!maxP||!duration||!groupLink) return alert("Fill all fields");

    const ms = unit==='minutes'?duration*60000:unit==='hours'?duration*3600000:duration*86400000;
    const expiry = Date.now()+ms;

    try {
      const docRef = await db.collection('sessions').add({
        owner, maxParticipants:maxP, expiry, participants:[], groupLink, downloaded:false
      });
      localStorage.setItem('currentSessionID', docRef.id);

      sessionInfo.innerHTML = `Session ID: <b style="color:#00ffff;">${docRef.id}</b>`;
      shareSection.style.display = 'block';
      const url = `${window.location.origin}/participant.html?session=${docRef.id}`;
      shareLink.textContent = url;

      shareLink.onclick = () => {
        navigator.clipboard.writeText(url);
        shareLink.textContent='Copied!';
        setTimeout(()=>{shareLink.textContent=url},2000);
      };
    } catch(err) {
      console.error(err);
      alert("Failed to create session");
    }
  });
</script>
</body>
</html>
