<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Join Session - Shadow VCF</title>
<style>
body {
  font-family: 'Orbitron', sans-serif;
  background: #0a0a0a;
  color: #e2e2e2;
  text-align: center;
  padding: 20px;
}
h1 { text-shadow: 0 0 10px #bc13fe; }
.container {
  max-width: 400px;
  margin: auto;
  background: rgba(20,0,40,0.8);
  padding: 25px;
  border-radius: 40px;
  border: 2px solid #bc13fe;
  box-shadow: 0 0 20px #bc13fe;
}
input, button {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 25px;
  border: 1px solid #00ffff;
  background: #111;
  color: #e2e2e2;
  font-size: 1em;
  text-align: center;
}
button {
  background: linear-gradient(to right, #bc13fe, #00ffff);
  border: none;
  cursor: pointer;
  font-weight: bold;
  box-shadow: 0 0 15px #bc13fe;
}
button:hover { transform: translateY(-2px); box-shadow: 0 0 25px #00ffff; }
#status { margin-top: 15px; color: #00ffff; min-height: 20px; }
</style>
</head>
<body>

<h1>Join Shadow VCF Session</h1>
<div class="container">
  <input type="text" id="participantName" placeholder="Your Name">
  <input type="text" id="participantNumber" placeholder="Phone Number (+1234567890)">
  <button id="joinSessionBtn">Save & Join Group</button>
  <div id="status"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/11.24.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.24.0/firebase-firestore.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBnbWvBJ_KtXl_1KpPGCmr-os4gKIP_uhM",
  authDomain: "shadow-vcf.firebaseapp.com",
  projectId: "shadow-vcf",
  storageBucket: "shadow-vcf.firebasestorage.app",
  messagingSenderId: "575022348228",
  appId: "1:575022348228:web:447dde12e94ac740079691"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const urlParams = new URLSearchParams(window.location.search);
const sessionID = urlParams.get('session');
const statusDiv = document.getElementById('status');

function isValidIntlNumber(number){
  return /^\+[1-9]\d{6,14}$/.test(number);
}

document.getElementById('joinSessionBtn').addEventListener('click', async()=>{
  const name = document.getElementById('participantName').value.trim();
  const number = document.getElementById('participantNumber').value.trim();
  if(!name) return alert("Enter your name");
  if(!isValidIntlNumber(number)) return alert("Number must be +1234567890 format");
  if(!sessionID) return alert("Invalid session");

  try{
    const docRef = db.collection("sessions").doc(sessionID);
    const docSnap = await docRef.get();
    if(!docSnap.exists) return alert("Session not found");

    const session = docSnap.data();
    if(session.participants.length >= session.maxParticipants) return alert("Session full");

    const join = confirm(`âœ… Info valid! Click OK to join the group:\n${session.groupLink}`);
    if(join){
      await docRef.update({ participants: firebase.firestore.FieldValue.arrayUnion({name,number}) });
      statusDiv.textContent="ðŸŽ‰ Info saved! Joined successfully!";
      document.getElementById('participantName').value='';
      document.getElementById('participantNumber').value='';
    }else{ alert("You must join the group to save your info!"); }
  }catch(err){console.error(err); alert("Failed to join session");}
});
</script>
</body>
</html>
